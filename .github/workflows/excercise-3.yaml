name: HST - Uebung 3
on:  push
jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [20, 22]
    steps:
    - uses: actions/checkout@v4
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
    - run: npm install
    - run: npm test
    - name: Deploy
      run: ./deploy/deploy.sh
      env:
        API_TOKEN: ${{ secrets.API_TOKEN }}
    - name: Create timestamp
      id: create_timestamp
      run: |
        CURRENT_DATE=$(date +'%Y-%m-%d')
        echo "current date $CURRENT_DATE"
        echo "current_timestamp=$CURRENT_DATE" >> "$GITHUB_OUTPUT"
        echo "current_branch=${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}}" >> $GITHUB_OUTPUT"
    - name: Create image
      run: echo "Create docker image with tag ${{ steps.create_timestamp.outputs.current_timestamp }}"
    - name: Deploy tag
      run: echo "Deploy tag ${{ steps.create_timestamp.outputs.current_timestamp }} to environment"
    - name: Echo Branchname
      run: echo "Current Branch ${{ steps.create_timestamp.outputs.current_branch }}"
